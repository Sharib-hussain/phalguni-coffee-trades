<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Phalguni Coffee Trades ‚Äî Today's Buying Price & History</title>
  <meta name="description" content="Daily buying prices (per kg) for Arabica & Robusta with 7-day history. Updated by Phalguni Coffee Trades." />
  <!-- Favicons -->
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="shortcut icon" href="/favicon.svg">
  <link rel="apple-touch-icon" href="/favicon.svg">
  <style>
    :root{
      --bg:#f7f2ec;
      --card:#fff;
      --accent:#6b4226;
      --accent-2:#a46b39;
      --muted:#7b6b61;
      --green:#557a46;
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg) 0%, #fff 100%);color:var(--accent-2)}
    .wrap{max-width:980px;margin:28px auto;padding:22px}
    header{
      background: linear-gradient(to bottom, rgba(107,66,38,0.05), transparent);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
    }
    .header-top{
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      margin-bottom: 20px;
    }
    .logo{
      width: 72px;
      height: 72px;
      border-radius: 16px;
      background: linear-gradient(135deg,var(--accent) 0%,var(--accent-2) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 700;
      font-size: 20px;
      box-shadow: 0 8px 24px rgba(107,66,38,0.15);
      transition: transform 0.2s ease;
    }
    .logo:hover {
      transform: translateY(-2px);
    }
    h1{
      margin: 0;
      font-size: 28px;
      text-align: center;
      background: linear-gradient(135deg,var(--accent) 0%,var(--accent-2) 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 800;
    }
    p.lead{
      margin: 8px 0 0;
      color: var(--muted);
      text-align: center;
      font-size: 15px;
      letter-spacing: 0.2px;
    }
  .grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:18px;margin-top:18px}
    .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(98,68,44,.06);min-height:120px;display:flex;flex-direction:column;justify-content:space-between}
    .type{font-size:13px;color:var(--muted);letter-spacing:0.6px}
    .price{font-weight:800;font-size:34px;color:var(--accent)}
    .meta{font-size:13px;color:var(--muted)}
    .btn{display:inline-flex;align-items:center;gap:6px;padding:10px 14px;border-radius:10px;background:var(--accent);color:white;text-decoration:none;font-weight:600;cursor:pointer;border:none}
    .btn:disabled{opacity:.6;cursor:default}
    .btn.btn-secondary{background:var(--accent-2)}
    .btn .icon{font-size:16px}
    /* Copy success animation */
    @keyframes copySuccess {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }
    .copy-success .icon{
      animation: copySuccess 0.5s ease-in-out;
    }
  /* loading state */
  .btn.loading{position:relative;padding-left:42px}
  .btn.loading::before{content:'';position:absolute;left:12px;top:50%;width:18px;height:18px;margin-top:-9px;border-radius:50%;border:2px solid rgba(255,255,255,.35);border-top-color:white;animation:spin 1s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
    .controls{display:flex;gap:12px;align-items:center;margin-left: 124px;}
    footer{margin-top:26px;padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(85,122,70,0.05),transparent);color:var(--muted);display:flex;justify-content:space-between;align-items:center}
    .small{font-size:13px}
    /* Contact card styles */
    .contact-card{
      max-width:500px;
      margin:0 auto;
      padding:24px !important;
    }
    .contact-header{
      margin:0;
      color:var(--accent);
      font-size:22px;
      text-align:center;
    }
    .contact-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:20px;
      margin:16px 0;
    }
    .contact-item{
      text-align:center;
    }
    .contact-name{
      font-weight:700;
      color:var(--accent-2);
      margin-bottom:4px;
    }
    .contact-phone{
      color:var(--accent);
      font-weight:600;
    }
    .location{
      font-weight: bold;
      text-align:center;
      margin-top:12px;
      padding-top:12px;
      border-top:1px solid rgba(107,66,38,.1);
    }
    /* Floating action buttons */
    .fab{
      display:none; /* Hidden by default */
      position:fixed;
      right:18px;
      width:56px;
      height:56px;
      border-radius:50%;
      color:#fff;
      align-items:center;
      justify-content:center;
      border:none;
      cursor:pointer;
      z-index:40;
      transition:transform 0.2s;
    }
    .fab:hover{
      transform:scale(1.05);
    }
    .fab-primary{
      bottom:18px;
      background:var(--accent);
      box-shadow:0 8px 20px rgba(107,66,38,.18);
    }
    .fab-secondary{
      bottom:90px;
      background:var(--accent-2);
      box-shadow:0 8px 20px rgba(164,107,57,.18);
    }
    .fab.loading{
      padding:0;
    }
    .fab.copy-success{
      background:var(--green);
    }

    @media (max-width:720px){
      .grid{grid-template-columns:1fr}
      .wrap{padding:14px}
      .logo{width:64px;height:64px}
      /* Mobile header layout */
      header{align-items:center;gap:12px;flex-wrap:wrap}
      header > div:nth-child(2){
        flex:1;
        min-width:200px;
        text-align:center;
      }
      .price{font-size:38px}
      .card{padding:16px}
      footer{flex-direction:column;gap:8px;align-items:flex-start}
      /* Show FABs on mobile */
      .fab{
        display:flex;
      }
    }
    
    @media (min-width:721px) and (max-width:980px){
      .grid{grid-template-columns:1fr 1fr}
    }
    /* Notification banner styles */
    @keyframes scroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }
    .notification-banner {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(90deg, var(--accent) 0%, var(--accent-2) 100%);
      color: white;
      padding: 8px 0;
      white-space: nowrap;
      overflow: hidden;
      z-index: 100;
      box-shadow: 0 2px 12px rgba(107,66,38,0.15);
    }
    .notification-text {
      display: inline-block;
      animation: scroll 20s linear infinite;
      padding-right: 50px;
      transform: translateX(0);
    }
    body::before{content:'';position:fixed;inset:0;background-image:radial-gradient(circle at 10% 20%, rgba(107,66,38,.02) 0 2px, transparent 2px), radial-gradient(circle at 80% 60%, rgba(107,66,38,.02) 0 3px, transparent 3px);pointer-events:none}
    table{width:100%;border-collapse:collapse;margin-top:18px}
    table th, table td{border:1px solid #ddd;padding:8px;text-align:center}
    table th{background-color:var(--accent-2);color:white}
    canvas{margin-top:20px}
  </style>
</head>
<body>
  <div class="notification-banner">
    <div class="notification-text">‚ö†Ô∏è Important: These rates are applicable for coffee with 90% or more fruits. Rates may vary for coffee with less than 90% fruits. ‚ö†Ô∏è</div>
  </div>
  <div class="wrap" style="margin-top: 50px">
    <header>
      <div class="header-top">
        <div class="logo">PC</div>
        <div class="controls">
          <button id="langToggle" class="btn btn-secondary">üáÆüá≥ ‡≤ï‡≤®‡≥ç‡≤®‡≤°</button>
        </div>
        <div>
          <a id="refreshBtn" class="btn" href="#" style="display: none;">Refresh</a>
        </div>
      </div>
      <div>
        <h1>Phalguni Coffee Trades</h1>
        <p class="lead">Live buying prices (per kg) & 7-day history</p>
      </div>
    </header>

    <main>
      <div class="grid">
        <div class="card" id="arabicaCard">
          <div>
            <div class="type">Arabica ‚Äî Raw / Green (per kg)</div>
            <div class="price" id="arabicaPrice">‚Äî</div>
          </div>
          <div class="meta">Last updated: <span id="arabicaTime">‚Äî</span></div>
        </div>

        <div class="card" id="robustaCard">
          <div>
            <div class="type">Robusta ‚Äî Raw / Green (per kg)</div>
            <div class="price" id="robustaPrice">‚Äî</div>
          </div>
          <div class="meta">Last updated: <span id="robustaTime">‚Äî</span></div>
        </div>

        <div class="card" id="arecanutCard">
          <div>
            <div class="type">Arecanut ‚Äî Raw (per kg)</div>
            <div class="price" id="arecanutPrice">‚Äî</div>
          </div>
          <div class="meta">Last updated: <span id="arecanutTime">‚Äî</span></div>
        </div>
      </div>

      <h2>Price History (Past 7 Days)</h2>
      <table id="historyTable">
        <thead>
          <tr><th>Date</th><th>Arabica (‚Çπ/kg)</th><th>Robusta (‚Çπ/kg)</th><th>Arecanut (‚Çπ/kg)</th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <canvas id="historyChart" height="150"></canvas>

      <div style="margin-top:18px">
        <div class="card contact-card">
          <h2 class="contact-header">Please Contact</h2>
          <div class="contact-grid">
            <div class="contact-item">
              <div class="contact-name">Samanth B P</div>
              <div class="contact-phone">+91 8277446831</div>
            </div>
            <div class="contact-item">
              <div class="contact-name">Shashwath M R</div>
              <div class="contact-phone">+91 9902440431</div>
            </div>
          </div>
          <div class="meta location">Location: In and around Mudigere | Chickmagaluru | Belur | Sakaleshpura¬∑</div>
        </div>
      </div>
    </main>

    <footer>
      <div class="small">Prices are per kg. For bulk orders please call.</div>
      <div class="small">Made with care ¬∑ Phalguni Coffee Trades</div>
    </footer>
  </div>

  <!-- Floating action buttons -->
  <button id="fabRefresh" class="fab fab-primary" title="Refresh" style="display:none">‚ü≥</button>
  <button id="copyMsg" class="fab fab-secondary" title="Copy Price Message">üìã</button>
  <script>
  // === Bilingual Text Data ===
  const translations = {
    en: {
      title: "Phalguni Coffee Trades",
      subtitle: "Live buying prices (per kg) & 7-day history",
      arabica: "Arabica ‚Äî Raw / Green (per kg)",
      robusta: "Robusta ‚Äî Raw / Green (per kg)",
      arecanut: "Arecanut ‚Äî Raw (per kg)",
      historyTitle: "Price History (Past 7 Days)",
      contactHeader: "Please Contact",
      location: "Location: In and around Mudigere | Chickmagaluru | Belur | Sakaleshpura",
      note: "‚ö†Ô∏è Important: These rates apply for coffee with 90% or more fruits. Rates may vary for coffee with less than 90% fruits.",
      footer1: "Prices are per kg. For bulk orders please call.",
      footer2: "Made with care ¬∑ Phalguni Coffee Trades",
      copyMessage: `Phalguni Coffee Trades

Date: {date}
Arabica Raw Coffee: ‚Çπ{arabica}
Robusta Raw Coffee: ‚Çπ{robusta}
Arecanut Raw: ‚Çπ{arecanut}

‚ö†Ô∏è Note: These rates are applicable for coffee with 90% or more fruits.
Rates may vary for coffee with less than 90% fruits.

Contact Details:
Samanth B P: +91 8277446831
Shashwath M R: +91 9902440431

Location: In and around 
Mudigere | Chickmagaluru | Belur | Sakaleshpura¬∑`
    },
    kn: {
      title: "‡≤´‡≤≤‡≥ç‡≤ó‡≥Å‡≤£‡≤ø ‡≤ï‡≤æ‡≤´‡≤ø ‡≤ü‡≥ç‡≤∞‡≥á‡≤°‡≥ç‡≤∏‡≥ç",
      subtitle: "‡≤¶‡≤ø‡≤®‡≤®‡≤ø‡≤§‡≥ç‡≤Ø‡≤¶ ‡≤ñ‡≤∞‡≥Ä‡≤¶‡≤ø ‡≤¨‡≥Ü‡≤≤‡≥Ü‡≤ó‡≤≥‡≥Å (‡≤™‡≥ç‡≤∞‡≤§‡≤ø ‡≤ï‡≥Ü.‡≤ú‡≤ø) ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å 7 ‡≤¶‡≤ø‡≤®‡≤ó‡≤≥ ‡≤á‡≤§‡≤ø‡≤π‡≤æ‡≤∏",
      arabica: "‡≤Ö‡≤∞‡≥á‡≤¨‡≤ø‡≤ï‡≤æ ‚Äî ‡≤ï‡≤ö‡≥ç‡≤ö‡≤æ / ‡≤π‡≤∏‡≤ø‡≤∞‡≥Å (‡≤™‡≥ç‡≤∞‡≤§‡≤ø ‡≤ï‡≥Ü.‡≤ú‡≤ø)",
      robusta: "‡≤∞‡≥ã‡≤¨‡≤∏‡≥ç‡≤ü‡≤æ ‚Äî ‡≤ï‡≤ö‡≥ç‡≤ö‡≤æ / ‡≤π‡≤∏‡≤ø‡≤∞‡≥Å (‡≤™‡≥ç‡≤∞‡≤§‡≤ø ‡≤ï‡≥Ü.‡≤ú‡≤ø)",
      arecanut: "‡≤Ö‡≤°‡≤ø‡≤ï‡≥Ü ‚Äî ‡≤ï‡≤ö‡≥ç‡≤ö‡≤æ (‡≤™‡≥ç‡≤∞‡≤§‡≤ø ‡≤ï‡≥Ü.‡≤ú‡≤ø)",
      historyTitle: "‡≤¨‡≥Ü‡≤≤‡≥Ü‡≤Ø ‡≤á‡≤§‡≤ø‡≤π‡≤æ‡≤∏ (‡≤ï‡≤≥‡≥Ü‡≤¶ 7 ‡≤¶‡≤ø‡≤®‡≤ó‡≤≥‡≥Å)",
      contactHeader: "‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø",
      location: "‡≤∏‡≥ç‡≤•‡≤≥: ‡≤Æ‡≥Ç‡≤°‡≤ø‡≤ó‡≥Ü‡≤∞‡≥Ü | ‡≤ö‡≤ø‡≤ï‡≥ç‡≤ï‡≤Æ‡≤ó‡≤≥‡≥Ç‡≤∞‡≥Å | ‡≤¨‡≥á‡≤≤‡≥Ç‡≤∞‡≥Å | ‡≤∏‡≤æ‡≤ï‡≥ç‡≤≤‡≥á‡≤∂‡≤™‡≥Å‡≤∞ ‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤Æ‡≥Å‡≤§‡≥ç‡≤§‡≤≤‡≤ø‡≤® ‡≤™‡≥ç‡≤∞‡≤¶‡≥á‡≤∂‡≤ó‡≤≥‡≥Å",
      note: "‚ö†Ô∏è ‡≤ó‡≤Æ‡≤®‡≤ø‡≤∏‡≤ø: ‡≤à ‡≤¶‡≤∞‡≤ó‡≤≥‡≥Å 90% ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤π‡≥Ü‡≤ö‡≥ç‡≤ö‡≥Å ‡≤π‡≤£‡≥ç‡≤£‡≥Å‡≤ó‡≤≥‡≤ø‡≤∞‡≥Å‡≤µ ‡≤ï‡≤æ‡≤´‡≤ø‡≤ó‡≥Ü ‡≤Ö‡≤®‡≥ç‡≤µ‡≤Ø‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤µ‡≥Ü. 90% ‡≤ï‡≥ç‡≤ï‡≤ø‡≤Ç‡≤§ ‡≤ï‡≤°‡≤ø‡≤Æ‡≥Ü ‡≤π‡≤£‡≥ç‡≤£‡≥Å‡≤ó‡≤≥‡≤ø‡≤¶‡≥ç‡≤¶‡≤∞‡≥Ü ‡≤¶‡≤∞‡≤ó‡≤≥‡≥Å ‡≤¨‡≤¶‡≤≤‡≤æ‡≤ó‡≤¨‡≤π‡≥Å‡≤¶‡≥Å.",
      footer1: "‡≤¨‡≥Ü‡≤≤‡≥Ü‡≤ó‡≤≥‡≥Å ‡≤™‡≥ç‡≤∞‡≤§‡≤ø ‡≤ï‡≥Ü.‡≤ú‡≤ø ‡≤ó‡≥Ü. ‡≤¶‡≥ä‡≤°‡≥ç‡≤° ‡≤™‡≥ç‡≤∞‡≤Æ‡≤æ‡≤£‡≤¶ ‡≤ñ‡≤∞‡≥Ä‡≤¶‡≤ø‡≤ó‡≥Ü ‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å ‡≤ï‡≤∞‡≥Ü ‡≤Æ‡≤æ‡≤°‡≤ø.",
      footer2: "‡≤™‡≥ç‡≤∞‡≥Ä‡≤§‡≤ø‡≤Ø‡≤ø‡≤Ç‡≤¶ ‡≤§‡≤Ø‡≤æ‡≤∞‡≤ø‡≤∏‡≤ø‡≤¶‡≤¶‡≥Å ¬∑ ‡≤´‡≤æ‡≤≤‡≥ç‡≤ó‡≥Å‡≤£‡≤ø ‡≤ï‡≤æ‡≤´‡≤ø ‡≤ü‡≥ç‡≤∞‡≥á‡≤°‡≥ç‡≤∏‡≥ç",
      copyMessage: `‡≤´‡≤≤‡≥ç‡≤ó‡≥Å‡≤£‡≤ø ‡≤ï‡≤æ‡≤´‡≤ø ‡≤ü‡≥ç‡≤∞‡≥á‡≤°‡≥ç‡≤∏‡≥ç

‡≤¶‡≤ø‡≤®‡≤æ‡≤Ç‡≤ï: {date}
‡≤Ö‡≤∞‡≥á‡≤¨‡≤ø‡≤ï‡≤æ ‡≤ï‡≤ö‡≥ç‡≤ö‡≤æ ‡≤ï‡≤æ‡≤´‡≤ø: ‚Çπ{arabica}
‡≤∞‡≥ã‡≤¨‡≤∏‡≥ç‡≤ü‡≤æ ‡≤ï‡≤ö‡≥ç‡≤ö‡≤æ ‡≤ï‡≤æ‡≤´‡≤ø: ‚Çπ{robusta}
‡≤Ö‡≤°‡≤ø‡≤ï‡≥Ü ‡≤ï‡≤ö‡≥ç‡≤ö‡≤æ: ‚Çπ{arecanut}

‚ö†Ô∏è ‡≤ó‡≤Æ‡≤®‡≤ø‡≤∏‡≤ø: ‡≤à ‡≤¶‡≤∞‡≤ó‡≤≥‡≥Å 90% ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤π‡≥Ü‡≤ö‡≥ç‡≤ö‡≥Å ‡≤π‡≤£‡≥ç‡≤£‡≥Å‡≤ó‡≤≥‡≤ø‡≤∞‡≥Å‡≤µ ‡≤ï‡≤æ‡≤´‡≤ø‡≤ó‡≥Ü ‡≤Ö‡≤®‡≥ç‡≤µ‡≤Ø‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤µ‡≥Ü.
90% ‡≤ï‡≥ç‡≤ï‡≤ø‡≤Ç‡≤§ ‡≤ï‡≤°‡≤ø‡≤Æ‡≥Ü ‡≤π‡≤£‡≥ç‡≤£‡≥Å‡≤ó‡≤≥‡≤ø‡≤¶‡≥ç‡≤¶‡≤∞‡≥Ü ‡≤¶‡≤∞‡≤ó‡≤≥‡≥Å ‡≤¨‡≤¶‡≤≤‡≤æ‡≤ó‡≤¨‡≤π‡≥Å‡≤¶‡≥Å.

‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï ‡≤µ‡≤ø‡≤µ‡≤∞‡≤ó‡≤≥‡≥Å:
‡≤∏‡≤Æ‡≤Ç‡≤§‡≥ç ‡≤¨‡≤ø ‡≤™‡≤ø: +91 8277446831
‡≤∂‡≤∂‡≥ç‡≤µ‡≤§‡≥ç ‡≤é‡≤Ç ‡≤Ü‡≤∞‡≥ç: +91 9902440431

‡≤∏‡≥ç‡≤•‡≤≥: ‡≤Æ‡≥Ç‡≤°‡≤ø‡≤ó‡≥Ü‡≤∞‡≥Ü | ‡≤ö‡≤ø‡≤ï‡≥ç‡≤ï‡≤Æ‡≤ó‡≤≥‡≥Ç‡≤∞‡≥Å | ‡≤¨‡≥á‡≤≤‡≥Ç‡≤∞‡≥Å | ‡≤∏‡≤æ‡≤ï‡≥ç‡≤≤‡≥á‡≤∂‡≤™‡≥Å‡≤∞ ‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤Æ‡≥Å‡≤§‡≥ç‡≤§‡≤≤‡≤ø‡≤® ‡≤™‡≥ç‡≤∞‡≤¶‡≥á‡≤∂‡≤ó‡≤≥‡≥Å¬∑`
    }
  };

  let currentLang = "en";

  // === Function to swap text ===
  function setLanguage(lang) {
    const t = translations[lang];
    document.querySelector("h1").textContent = t.title;
    document.querySelector(".lead").textContent = t.subtitle;
    document.querySelector("#arabicaCard .type").textContent = t.arabica;
    document.querySelector("#robustaCard .type").textContent = t.robusta;
    document.querySelector("#arecanutCard .type").textContent = t.arecanut;
    document.querySelector("main h2").textContent = t.historyTitle;
    document.querySelector(".contact-header").textContent = t.contactHeader;
    document.querySelector(".location").textContent = t.location;
    document.querySelector(".notification-text").textContent = t.note;
    document.querySelector("footer div:nth-child(1)").textContent = t.footer1;
    document.querySelector("footer div:nth-child(2)").textContent = t.footer2;

    // ‚úÖ Update <html lang="">
    document.documentElement.lang = lang;

    // Button label toggle
    const btn = document.getElementById("langToggle");
    if (btn) btn.textContent = lang === "en" ? "üáÆüá≥ ‡≤ï‡≤®‡≥ç‡≤®‡≤°" : "üá¨üáß English";

    currentLang = lang;
  }

  // === Handle button click ===
  const langBtn = document.getElementById("langToggle");
  if (langBtn && !langBtn.dataset.bound) {
    langBtn.addEventListener("click", () => {
      setLanguage(currentLang === "en" ? "kn" : "en");
    });
    langBtn.dataset.bound = "true";
  }

  // === Copy message ===
  function copyToClipboard() {
    const t = translations[currentLang];
    const arabica = document.getElementById("arabicaRate").textContent.trim();
    const robusta = document.getElementById("robustaRate").textContent.trim();
    const arecanut = document.getElementById("arecanutRate").textContent.trim();
    const today = new Date().toISOString().split("T")[0];
    const message = t.copyMessage
      .replace("{arabica}", arabica)
      .replace("{robusta}", robusta)
      .replace("{arecanut}", arecanut)
      .replace("{date}", today);

    navigator.clipboard.writeText(message);
    alert(currentLang === "kn" ? "‡≤∏‡≤Ç‡≤¶‡≥á‡≤∂ ‡≤®‡≤ï‡≤≤‡≤æ‡≤Ø‡≤ø‡≤§‡≥Å ‚úÖ" : "Message copied ‚úÖ");
  }

  // === Bind copy button (safe) ===
  const copyBtnEl = document.getElementById("copyBtn");
  if (copyBtnEl && !copyBtnEl.dataset.bound) {
    copyBtnEl.addEventListener("click", copyToClipboard);
    copyBtnEl.dataset.bound = "true";
  }

  // === Auto-detect language ===
  const userLang = navigator.language.startsWith("kn") ? "kn" : "en";
  setLanguage(userLang);
</script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
  const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS9DnNnxDj2n3Fy9-JVnnouxDoZ_VZ9au3wRXNO_s0CYLED7mGHPfpolUAhNCpNyeAvMJYD7kGXBl_K/pub?gid=0&single=true&output=csv";
    const priceMap = { 
      Arabica: {priceEl: 'arabicaPrice', timeEl: 'arabicaTime'}, 
      Robusta: {priceEl: 'robustaPrice', timeEl: 'robustaTime'},
      Arecanut: {priceEl: 'arecanutPrice', timeEl: 'arecanutTime'}
    };

    async function fetchPrices(){
      try{
        if(!SHEET_CSV_URL || SHEET_CSV_URL.includes('REPLACE_WITH')){
          showPlaceholder();
          return;
        }
        const resp = await fetch(SHEET_CSV_URL, {cache: 'no-store'});
        if(!resp.ok) throw new Error('Failed to fetch sheet');
        const csv = await resp.text();
        const rows = csv.trim().split('\n').map(r=>r.split(','));
        const header = rows[0].map(h=>h.trim().toLowerCase());
        console.log('CSV Headers:', header); // Debug log
        const dataRows = rows.slice(-7); // last 7 rows for history
        console.log('Data rows:', dataRows); // Debug log

        // Convert rows to objects and sort by date to find most recent
        const sortedData = dataRows.map(row => ({
          date: row[0],
          arabica: row[1],
          robusta: row[2],
          arecanut: row[3] ? row[3].replace('\r', '') : '‚Äî',
          timestamp: new Date(row[0]).getTime()
        }))
        .sort((a, b) => b.timestamp - a.timestamp); // Sort newest to oldest

        // Get the latest prices (most recent date)
        const latest = sortedData[0];
        
        // Update current prices
        updateUI('Arabica', latest.arabica, latest.date);
        updateUI('Robusta', latest.robusta, latest.date);
        updateUI('Arecanut', latest.arecanut, latest.date);
        
        // Update history - use the already sorted data
        // Update history - use the already sorted data
        updateHistory(sortedData);
      }catch(err){
        console.error('Error fetching data:', err);
        document.getElementById('arabicaPrice').textContent = '‚Äî';
        document.getElementById('robustaPrice').textContent = '‚Äî';
        throw err; // rethrow so callers (refresh button) can react
      }
    }

    function updateUI(type, price, updatedAt) {
      const mapping = priceMap[type];
        if (!mapping) return;

      const priceEl = document.getElementById(mapping.priceEl);
      const timeEl = document.getElementById(mapping.timeEl);

      // Handle empty or invalid values (blank cell in sheet)
      if (!price || price.trim() === "" || isNaN(Number(price))) {
        priceEl.textContent = "‚Äî"; // show dash
      } else {
        priceEl.textContent = "‚Çπ " + Number(price).toLocaleString("en-IN");
    }

    timeEl.textContent = updatedAt;
  }

    function updateHistory(data){
      const tbody = document.querySelector('#historyTable tbody');
      tbody.innerHTML = '';
      const labels = [], arabicaArr = [], robustaArr = [], arecanutArr = [];
      // Reverse the data array to show older dates first (left to right)
      const reversedData = [...data].reverse();
      
      reversedData.forEach(d=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${d.date}</td><td>‚Çπ ${d.arabica}</td><td>‚Çπ ${d.robusta}</td><td>‚Çπ ${d.arecanut}</td>`;
        tbody.appendChild(tr);
        labels.push(d.date);
        arabicaArr.push(Number(d.arabica));
        robustaArr.push(Number(d.robusta));
        arecanutArr.push(d.arecanut === '‚Äî' ? null : Number(d.arecanut));
      });
      // chart
      const ctx = document.getElementById('historyChart').getContext('2d');
      if(window.priceChart) window.priceChart.destroy();
      window.priceChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {label:'Arabica', data: arabicaArr, borderColor:'#6b4226', backgroundColor:'rgba(107,66,38,0.2)', tension:0.3},
            {label:'Robusta', data: robustaArr, borderColor:'#557a46', backgroundColor:'rgba(85,122,70,0.2)', tension:0.3},
            {label:'Arecanut', data: arecanutArr, borderColor:'#d4af37', backgroundColor:'rgba(212,175,55,0.2)', tension:0.3}
          ]
        },
        options:{responsive:true,plugins:{legend:{position:'top'}},scales:{y:{beginAtZero:false}}}
      });
    }

    function showPlaceholder(){
      document.getElementById('arabicaPrice').textContent = '‚Äî';
      document.getElementById('robustaPrice').textContent = '‚Äî';
      document.getElementById('arecanutPrice').textContent = '‚Äî';
    }

    // Button helpers
    const refreshBtn = document.getElementById('refreshBtn');
    const fabRefresh = document.getElementById('fabRefresh');

    function setButtonLoading(el, isLoading){
      if(!el) return;
      if(isLoading){
        el.classList.add('loading');
        el.disabled = true;
        el.dataset.orig = el.textContent;
        el.textContent = 'Loading‚Ä¶';
      } else {
        el.classList.remove('loading');
        el.disabled = false;
        if(el.dataset.orig) el.textContent = el.dataset.orig;
      }
    }

    function setButtonText(el, text){ if(el) el.textContent = text; }

    // Wrapper that shows loading state and calls fetchPrices
    async function handleRefreshClick(e){
      e && e.preventDefault();
      // Shift/Ctrl click => hard reload
      if(e && (e.shiftKey || e.ctrlKey)){
        window.location.reload();
        return;
      }
      setButtonLoading(refreshBtn, true);
      setButtonLoading(fabRefresh, true);
      try{
        await fetchPrices();
        setButtonText(refreshBtn, 'Updated');
        setButtonText(fabRefresh, '‚úì');
        await new Promise(r=>setTimeout(r,1200));
      }catch(err){
        setButtonText(refreshBtn, 'Error');
        setButtonText(fabRefresh, '‚ö†');
        console.error('Refresh failed:', err);
        await new Promise(r=>setTimeout(r,1500));
      } finally{
        setButtonLoading(refreshBtn, false);
        setButtonLoading(fabRefresh, false);
        setButtonText(refreshBtn, 'Refresh');
        setButtonText(fabRefresh, '‚ü≥');
      }
    }

    refreshBtn.addEventListener('click', handleRefreshClick);
    fabRefresh.addEventListener('click', handleRefreshClick);

    // Show/hide fab on small screens
    function updateFabVisibility(){
      if(window.matchMedia && window.matchMedia('(max-width:720px)').matches){
        fabRefresh.style.display = 'flex';
      } else {
        fabRefresh.style.display = 'none';
      }
    }
    window.addEventListener('resize', updateFabVisibility);
    updateFabVisibility();

    // Make fetchPrices rethrow so wrapper can react to errors
    const originalFetchPrices = fetchPrices;
    async function fetchPricesWrapper(){
      try{
        await originalFetchPrices();
      }catch(err){
        throw err;
      }
    }

    // Message copy functionality
    const copyBtn = document.getElementById('copyMsg');
    
    function generatePriceMessage() {
      const lang = document.documentElement.lang || "en";
      const arabicaPrice = document.getElementById('arabicaPrice').textContent.trim();
      const robustaPrice = document.getElementById('robustaPrice').textContent.trim();
      const arecanutPrice = document.getElementById('arecanutPrice').textContent.trim();
      const date = document.getElementById('arabicaTime').textContent.trim();

  // Build message depending on language
  const message = lang === "kn"
    ? `‚òï ‡≤´‡≤≤‡≥ç‡≤ó‡≥Å‡≤£‡≤ø ‡≤ï‡≤æ‡≤´‡≤ø ‡≤ü‡≥ç‡≤∞‡≥á‡≤°‡≥ç‡≤∏‡≥ç

‡≤¶‡≤ø‡≤®‡≤æ‡≤Ç‡≤ï: ${date}
‡≤Ö‡≤∞‡≥á‡≤¨‡≤ø‡≤ï‡≤æ ‡≤ï‡≤ö‡≥ç‡≤ö‡≤æ ‡≤ï‡≤æ‡≤´‡≤ø: ‚Çπ${arabicaPrice}
‡≤∞‡≥ã‡≤¨‡≤∏‡≥ç‡≤ü‡≤æ ‡≤ï‡≤ö‡≥ç‡≤ö‡≤æ ‡≤ï‡≤æ‡≤´‡≤ø: ‚Çπ${robustaPrice}
‡≤Ö‡≤°‡≤ø‡≤ï‡≥Ü ‡≤ï‡≤ö‡≥ç‡≤ö‡≤æ: ‚Çπ${arecanutPrice}

‚ö†Ô∏è ‡≤ó‡≤Æ‡≤®‡≤ø‡≤∏‡≤ø: ‡≤à ‡≤¶‡≤∞‡≤ó‡≤≥‡≥Å 90% ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤π‡≥Ü‡≤ö‡≥ç‡≤ö‡≥Å ‡≤π‡≤£‡≥ç‡≤£‡≥Å‡≤ó‡≤≥‡≤ø‡≤∞‡≥Å‡≤µ ‡≤ï‡≤æ‡≤´‡≤ø‡≤ó‡≥Ü ‡≤Ö‡≤®‡≥ç‡≤µ‡≤Ø‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤µ‡≥Ü.
90% ‡≤ï‡≥ç‡≤ï‡≤ø‡≤Ç‡≤§ ‡≤ï‡≤°‡≤ø‡≤Æ‡≥Ü ‡≤π‡≤£‡≥ç‡≤£‡≥Å‡≤ó‡≤≥‡≤ø‡≤¶‡≥ç‡≤¶‡≤∞‡≥Ü ‡≤¶‡≤∞‡≤ó‡≤≥‡≥Å ‡≤¨‡≤¶‡≤≤‡≤æ‡≤ó‡≤¨‡≤π‡≥Å‡≤¶‡≥Å.

‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï ‡≤µ‡≤ø‡≤µ‡≤∞‡≤ó‡≤≥‡≥Å:
‡≤∏‡≤Æ‡≤Ç‡≤§‡≥ç ‡≤¨‡≤ø ‡≤™‡≤ø: +91 8277446831
‡≤∂‡≤∂‡≥ç‡≤µ‡≤§‡≥ç ‡≤é‡≤Ç ‡≤Ü‡≤∞‡≥ç: +91 9902440431

‡≤∏‡≥ç‡≤•‡≤≥: ‡≤Æ‡≥Ç‡≤°‡≤ø‡≤ó‡≥Ü‡≤∞‡≥Ü | ‡≤ö‡≤ø‡≤ï‡≥ç‡≤ï‡≤Æ‡≤ó‡≤≥‡≥Ç‡≤∞‡≥Å | ‡≤¨‡≥á‡≤≤‡≥Ç‡≤∞‡≥Å | ‡≤∏‡≤æ‡≤ï‡≥ç‡≤≤‡≥á‡≤∂‡≤™‡≥Å‡≤∞ ‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤Æ‡≥Å‡≤§‡≥ç‡≤§‡≤≤‡≤ø‡≤® ‡≤™‡≥ç‡≤∞‡≤¶‡≥á‡≤∂‡≤ó‡≤≥‡≥Å¬∑`
    : `Phalguni Coffee Trades

Date: ${date}
Arabica Raw Coffee: ${arabicaPrice}
Robusta Raw Coffee: ${robustaPrice}
Arecanut Raw: ${arecanutPrice}

‚ö†Ô∏è Note: These rates are applicable for coffee with 90% or more fruits.
Rates may vary for coffee with less than 90% fruits.

Contact Details:
Samanth B P: +91 8277446831
Shashwath M R: +91 9902440431

Location: In and around 
Mudigere | Chickmagaluru | Belur | Sakaleshpura¬∑`;

      return message;
    }

    copyBtn.addEventListener('click', async function() {
      try {
        const message = generatePriceMessage();
        await navigator.clipboard.writeText(message);
        
        // Visual feedback
        copyBtn.classList.add('copy-success');
        const originalText = copyBtn.innerHTML;
        copyBtn.innerHTML = '<span class="icon">‚úì</span> Copied!';
        
        setTimeout(() => {
          copyBtn.classList.remove('copy-success');
          copyBtn.innerHTML = originalText;
        }, 2000);
      } catch (err) {
        console.error('Failed to copy:', err);
        alert('Could not copy message. Please try again.');
      }
    });

    // Call the fetch on load but silence errors (UI already shows them)
    fetchPrices().catch(()=>{});
  </script>
</body>
</html>
